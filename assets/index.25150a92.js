import{z as e,bo as t,j as n,Z as i,D as o,F as s,w as r,a2 as a,a4 as l,a7 as c,ao as m,a0 as u,aA as d,N as g,r as p,ai as f,u as v,bE as w,a9 as h,bG as L,bH as x,aM as b}from"./vendor.816c78c5.js";/* empty css              */import{p as I,c as _,j as S,am as k}from"./index.fec87d2a.js";import{P as y}from"./index.e6650eff.js";/* empty css              *//* empty css              */import"./onMountedOrActivated.3c82604a.js";import"./useWindowSizeFn.b43d7152.js";import"./useContentViewHeight.5682504b.js";var C=e({name:"ImagePreview",components:{Image:t,PreviewGroup:t.PreviewGroup},props:{functional:I.bool,imageList:{type:Array}},setup(e){const{prefixCls:t}=_("image-preview");return{prefixCls:t,getImageList:n((()=>{const{imageList:t}=e;return t?t.map((e=>S(e)?{src:e,placeholder:!1}:e)):[]}))}}});C.render=function(e,t,n,g,p,f){const v=i("Image"),w=i("PreviewGroup");return o(),s("div",{class:e.prefixCls},[r(w,null,{default:a((()=>[!e.imageList||e.$slots.default?l(e.$slots,"default",{key:0}):(o(!0),s(c,{key:1},m(e.getImageList,(e=>(o(),s(v,u({key:e.src},e),d({_:2},[e.placeholder?{name:"placeholder",fn:a((()=>[r(v,u(e,{src:e.placeholder,preview:!1}),null,16,["src"])]))}:void 0]),1040)))),128))])),_:3})],2)};var D,P;(P=D||(D={}))[P.LOADING=0]="LOADING",P[P.DONE=1]="DONE",P[P.FAIL=2]="FAIL";const W={show:{type:Boolean,default:!1},imageList:{type:[Array],default:null},index:{type:Number,default:0},scaleStep:{type:Number},defaultWidth:{type:Number},maskClosable:{type:Boolean},rememberState:{type:Boolean}},j="img-preview";var N=e({name:"ImagePreview",props:W,emits:["img-load","img-error"],setup(e,{expose:t,emit:i}){const o=new Map,s=g({currentUrl:"",imgScale:1,imgRotate:0,imgTop:0,imgLeft:0,status:D.LOADING,currentIndex:0,moveX:0,moveY:0,show:e.show}),a=p(null),l=p(null);function c(){!function(){const e=v(a);if(!e)return;e.onmousewheel=d,document.body.addEventListener("DOMMouseScroll",d),document.ondragstart=function(){return!1}}();const{index:t,imageList:n}=e;if(!n||!n.length)throw new Error("imageList is undefined");s.currentIndex=t,S(n[t])}function m(){s.imgScale=1,s.imgRotate=0,s.imgTop=0,s.imgLeft=0}const u=n((()=>e.scaleStep>0&&e.scaleStep<100?e.scaleStep/100:s.imgScale/10));function d(e){(e=e||window.event).delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&b(u.value),e.delta<0&&b(-u.value)}function b(e){s.imgScale<=.2&&e<0||(s.imgScale+=e)}function I(e){s.imgRotate+=e}function _(){const e=v(l);e&&(e.onmousemove=null)}function S(t){s.status=D.LOADING;const n=new Image;n.src=t,n.onload=n=>{if(s.currentUrl!==t){const r=n.composedPath();if(e.rememberState){o.set(s.currentUrl,{scale:s.imgScale,top:s.imgTop,left:s.imgLeft,rotate:s.imgRotate});const n=o.get(t);n?(s.imgScale=n.scale,s.imgTop=n.top,s.imgRotate=n.rotate,s.imgLeft=n.left):(m(),e.defaultWidth&&(s.imgScale=e.defaultWidth/r[0].naturalWidth))}else e.defaultWidth&&(s.imgScale=e.defaultWidth/r[0].naturalWidth);r&&i("img-load",{index:s.currentIndex,dom:r[0],url:t})}s.currentUrl=t,s.status=D.DONE},n.onerror=e=>{const n=e.composedPath();n&&i("img-error",{index:s.currentIndex,dom:n[0],url:t}),s.status=D.FAIL}}function k(e){e&&e.stopPropagation(),y()}function y(){s.show=!1,document.body.removeEventListener("DOMMouseScroll",d),document.ondragstart=null}function C(){m()}function P(t){const{currentIndex:n}=s,{imageList:i}=e;"left"===t&&(s.currentIndex--,n<=0&&(s.currentIndex=i.length-1)),"right"===t&&(s.currentIndex++,n>=i.length-1&&(s.currentIndex=0)),S(i[s.currentIndex])}function W(e){e=e||window.event,s.moveX=e.clientX,s.moveY=e.clientY;const t=v(l);t&&(t.onmousemove=N)}function N(e){(e=e||window.event).preventDefault();const t=e.clientX-s.moveX,n=e.clientY-s.moveY;s.imgLeft+=t,s.imgTop+=n,s.moveX=e.clientX,s.moveY=e.clientY}t({resume:C,close:y,prev:P.bind(null,"left"),next:P.bind(null,"right"),setScale:e=>{e>0&&e<=10&&(s.imgScale=e)},setRotate:e=>{s.imgRotate=e}});const O=n((()=>{const{imgScale:t,imgRotate:n,imgTop:i,imgLeft:o}=s;return{transform:`scale(${t}) rotate(${n}deg)`,marginTop:`${i}px`,marginLeft:`${o}px`,maxWidth:e.defaultWidth?"unset":"100%"}})),A=n((()=>{const{imageList:t}=e;return t.length>1}));f((()=>{e.show&&c(),e.imageList&&m()}));const E=t=>{e.maskClosable&&t.target&&t.target.classList.contains("img-preview-content")&&k(t)},M=()=>{if(!v(A))return null;const{currentIndex:t}=s,{imageList:n}=e;return r("div",{class:"img-preview__index"},[t+1,h(" / "),n.length])},G=e=>v(A)?r("div",{class:["img-preview__arrow",e],onClick:()=>P(e)},[r("left"===e?L:x,null,null)]):null;return()=>s.show&&r("div",{class:j,ref:a,onMouseup:_,onClick:E},[r("div",{class:"img-preview-content"},[r("img",{style:v(O),class:["img-preview-image",s.status===D.DONE?"":"hidden"],ref:l,src:s.currentUrl,onMousedown:W},null),r("div",{class:"img-preview__close",onClick:k},[r(w,{class:"img-preview__close-icon"},null)]),M(),r("div",{class:"img-preview__controller"},[r("div",{class:"img-preview__controller-item",onClick:()=>b(-u.value)},[r("img",{src:"/workflow-test/assets/unscale.c552f416.svg"},null)]),r("div",{class:"img-preview__controller-item",onClick:()=>b(u.value)},[r("img",{src:"/workflow-test/assets/scale.44abde22.svg"},null)]),r("div",{class:"img-preview__controller-item",onClick:C},[r("img",{src:"/workflow-test/assets/resume.8f27866b.svg"},null)]),r("div",{class:"img-preview__controller-item",onClick:()=>I(-90)},[r("img",{src:"/workflow-test/assets/unrotate.ef6a2daf.svg"},null)]),r("div",{class:"img-preview__controller-item",onClick:()=>I(90)},[r("img",{src:"/workflow-test/assets/p-rotate.cb8bbfc3.svg"},null)])]),G("left"),G("right")])])}});let O=null;const A=["https://picsum.photos/id/66/346/216","https://picsum.photos/id/67/346/216","https://picsum.photos/id/68/346/216"];var E=e({components:{PageWrapper:y,ImagePreview:C},setup:()=>({imgList:A,openImg:function(){!function(e){var t;if(!k)return;const n={},i=document.createElement("div");Object.assign(n,{show:!0,index:0,scaleStep:100},e),O=r(N,n),b(O,i),document.body.appendChild(i),null==(t=O.component)||t.exposed}({imageList:A,defaultWidth:700,rememberState:!0,onImgLoad:({index:e,url:t,dom:n})=>{}})}})});const M=h("无预览图");E.render=function(e,t,n,l,c,m){const u=i("ImagePreview"),d=i("a-button"),g=i("PageWrapper");return o(),s(g,{title:"图片预览示例"},{default:a((()=>[r(u,{imageList:e.imgList},null,8,["imageList"]),r(d,{onClick:e.openImg,type:"primary"},{default:a((()=>[M])),_:1},8,["onClick"])])),_:1})};export{E as default};
